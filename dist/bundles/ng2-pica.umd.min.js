!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("exif-js/exif"),require("rxjs"),require("pica/dist/pica")):"function"==typeof define&&define.amd?define(["exports","@angular/core","exif-js/exif","rxjs","pica/dist/pica"],t):t(e["ng2-pica"]={},e.ng.core,null,e.Rx,null)}(this,function(e,t,n,o,c){"use strict";c=c&&c.hasOwnProperty("default")?c.default:c;var i=function(){function e(){}return e.prototype.getOrientedImage=function(f){return new Promise(function(u,e){var s;EXIF||(EXIF={getData:function(e,t){return t.call(f),!0},getTag:function(){return!1}}),EXIF.getData(f,function(){var e=EXIF.getTag(f,"Orientation");if(1!=e){var t=document.createElement("canvas"),n=t.getContext("2d"),i=f.width,r=f.height,a=0,o=0,c=0;switch(e){case 3:case 4:a=-f.width,o=-f.height,c=180;break;case 5:case 6:i=f.height,r=f.width,o=-f.height,c=90;break;case 7:case 8:i=f.height,r=f.width,a=-f.width,c=270}t.width=i,t.height=r,-1<[2,4,5,7].indexOf(e)&&(n.translate(i,0),n.scale(-1,1)),n.rotate(c*Math.PI/180),n.drawImage(f,a,o),(s=document.createElement("img")).width=i,s.height=r,s.addEventListener("load",function(){u(s)}),s.src=t.toDataURL("image/png")}else u(f)})})},e.decorators=[{type:t.Injectable}],e}(),r=function(){function e(e){this.imageExifService=e}return e.prototype.resize=function(e,t,n,i){void 0===i&&(i=!1);for(var r=new o.Subject,a=0;a<e.length;a++)this.resizeFile(e[a],t,n,i).then(function(e){r.next(e)}).catch(function(e){r.error(e)});return r.asObservable()},e.prototype.resizeCanvas=function(i,r,a){return new Promise(function(t,n){var e=new c;e&&e.resize||(e=new window.pica),e.resize(i,r,a).then(function(e){t(e)},function(e){n(e)})})},e.prototype.resizeBuffer=function(i){return new Promise(function(t,n){var e=new c;e&&e.resizeBuffer||(e=new window.pica),e.resizeBuffer(i).then(function(e){t(e)},function(e){n(e)})})},e.prototype.resizeFile=function(f,d,h,g){var p=this;return void 0===g&&(g=!1),new Promise(function(a,o){var c=document.createElement("canvas"),u=c.getContext("2d"),s=new Image;s.onload=function(){p.imageExifService.getOrientedImage(s).then(function(e){window.URL.revokeObjectURL(s.src),c.width=e.width,c.height=e.height,u.drawImage(e,0,0);var t=u.getImageData(0,0,e.width,e.height);if(g){var n=Math.min(d/t.width,h/t.height);d=Math.round(t.width*n),h=Math.round(t.height*n)}var i=!0;("image/jpeg"===f.type||"image/png"===f.type&&!p.isImgUsingAlpha(t))&&(i=!1,(u=c.getContext("2d",{alpha:!1})).drawImage(e,0,0));var r=document.createElement("canvas");r.width=d,r.height=h,p.resizeCanvas(c,r,{alpha:i}).then(function(e){e.toBlob(function(e){var t=p.generateResultFile(e,f.name,f.type,(new Date).getTime());a(t)},f.type)}).catch(function(e){o(e)})})},s.src=window.URL.createObjectURL(f)})},e.prototype.isImgUsingAlpha=function(e){for(var t=0;t<e.data.length;t+=4)if(255!==e.data[t+3])return!0;return!1},e.prototype.generateResultFile=function(e,t,n,i){var r=new Blob([e],{type:n});return this.blobToFile(r,t,i)},e.prototype.blobToFile=function(e,t,n){var i=e;return i.name=t,i.lastModified=n,i},e.decorators=[{type:t.Injectable}],e.ctorParameters=function(){return[{type:i,decorators:[{type:t.Inject,args:[t.forwardRef(function(){return i})]}]}]},e}(),a=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{providers:[{provide:r,useClass:r},{provide:i,useClass:i}]}]}],e}();e.Ng2PicaService=r,e.Ng2PicaModule=a,e.ImgExifService=i,Object.defineProperty(e,"__esModule",{value:!0})});